作者: 1281261856#qq.com

0.0.2.3414 2015年7月21日 16:24:57
快捷键Ctrl + M 相当于静音一次


0.0.2.3385 2015年7月21日 14:39:10
发送短信时前缀安定宝协议data段功能完成。


0.0.2.3381 2015年7月21日 11:26:04
1.修复发送短信后导致的内存泄漏
2.点击“静音一次”后：
	a.当仅有报警没有断线时，停止播放报警音
	b.当仅有断线没有报警时，停止播放断线音
	b.当有报警且有断线时，第一次点击消除报警音，第二次点击消除断线音


0.0.2.3367 2015年7月20日 14:28:33
1.不再使用从网络模块收到的时间戳为历史记录的时间，而是使用接收时间。
2.手动对码功能完成。在主机界面内、设置防区信息、手动写入对码信息。


0.0.2.3348 2015年7月18日 14:39:46
1.当修改了分机的信息（别名、联系人、地址、电话、备用电话等）后，立即更新分机界面的标题栏。
2.修复查询单个分机总是失败的bug


0.0.2.3304 2015年7月15日 16:11:22
历史记录相关：
最大记录60000条，每新增100条记录则检查一次是否到了最大数量，到达最大数量则自动导出，
自动导出的Excel文件保存在程序安装路径下的history文件夹中，
桌面上有该文件夹的快捷方式，名称为“历史记录”


0.0.2.3281 2015年7月15日 11:20:11
1.将所有配置文件与数据库文件移动到安装目录下的config文件夹，因此手动备份时只需要拷贝config与maps两个文件夹就可以了
2.短信模块功能开发基本完成，详见《接警中心短信相关功能使用说明.docx》


0.0.2.3225 2015年7月13日 15:22:13
1.删除主机后立即踢掉该链接（如果在线的话）
2.完善用户管理权限：
操作员账户权限：布撤防、查询分机、清除报警信息、静音一次、导出部分历史记录、打印历史记录、查看百度地图等
管理员账户权限：在拥有了操作员账户管理权限之外，增加主机管理、分机管理、防区管理、地图管理、探头管理、百度地图管理、恢复主机数据等权限
超级管理员账户权限：拥有所有权限，并可以管理账户，例如添加、删除管理员账户或操作员账户，修改账户密码等操作。


0.0.2.3197 2015年7月11日 17:26:13
1.修复打开分机窗口并当删除该分机后退出编辑模式时导致空指针引用导致程序崩溃的bug
2.当索要防区无回应时，重发


0.0.2.3178 2015年7月9日 22:08:18
1.区分远程事件的时间戳与接收时间，前者用来显示，后者用来过滤6秒内重复事件。
以修复当时间戳与本地时间不一致时导致的段时间内多条事件未过滤的问题。
2.设置debug版的查询分机超时时间为20秒
3.当导出所有历史记录后清除主机与分机界面内的历史记录
4.当导出所有历史记录后，重置ID为以1开始累增
4.加宽历史记录界面内“条/页”下拉框宽度
5.修复发行版的远控时死锁问题


0.0.2.3156
1.每隔16小时检查一次是否有分机超过16小时无联系
2.修复发送数据过慢的问题


0.0.2.3081 2015年6月29日 16:53:20
1.修复恢复主机数据时仅有有线防区导致崩溃的bug
2.将一些调试用的参数修改为发行版的参数（分机超时时间、历史记录提示频率等）


0.0.2.3076 2015年6月29日 15:30:51
自动查询失联分机相关：
检测到有失联分机时不再由用户选择“立即查询”或“1小时后提醒”，而是直接弹出查询分机界面
查询分机界面内不再倒数10秒后再开始查询，而是直接开始查询


0.0.2.3073 2015年6月25日 21:53:25
1.修复删除探头bug
2.探头编辑界面不再提供“防区编辑”与“地图编辑”的快捷方式


0.0.2.3048 2015年6月24日 14:35:37
1.修复xp兼容性
2.自动查询的超时时间为16小时
3.更新了布防、撤防和断线三个图标，以便区分


0.0.2.3029
1.用户权限完善，操作员禁止删除地图与探头
2.代码加固，消除主机按钮重叠bug、离线按钮文字非红色bug等
3.主机管理界面内完善按钮的禁用、启用


0.0.2.3017
1.用户权限完善
2.一些小更新
3.block mode


0.0.2.2956 2015年6月11日 13:42:29
所有离线主机都重新上线后不再播放离线提示音


0.0.2.2936 2015年6月8日 16:05:49
1.基本可以确定通信问题是由网络模块的MAC地址相同引起的
2.recv <= 0 则踢掉
3.修复主机服务期限管理界面内，选中条数变化时，下方显示的数字不一致的bug
4.索要防区信息重发等待时间缩短


0.0.2.2924 2015年6月6日 18:19:16
1.支持自动索要所有防区信息
2.历史记录对话框禁用最小化按钮


0.0.2.2900
1.程序记录分机状态
2.主机断线则将下属所有分机都置为断线状态
3.主机上线则根据记录的分机状态恢复分机图标


0.0.2.2887
1.主机管理界面内右击分组项即可对该分组的主机进行服务期限管理
2.服务期限管理界面内列表可排序
3.可打印选中


0.0.2.2869
设置client socket send/recv timeout为10s


0.0.2.2868
1.导出服务期限记录到Excel完成
2.设置send/recv timeout为10s


0.0.2.2854
使用std::map来存储container的machinedlg，目的为：
1.加快相应速度
2.减少出错几率


0.0.2.2839
打包pdb文件


0.0.2.2836
支持分机服务期限管理与提示


0.0.2.2811
对探头的移动范围的限制减少一些


0.0.2.2807
地图上显示的报警文字行数减少一行


0.0.2.2805
修复历史记录中“导出选中行到Excel”导出了全部历史记录的bug


0.0.2.2800
高亮显示报警tab项完成


0.0.2.2784
修复当用户添加地图时在“打开文件”窗口内修改文件名后找不到文件导致死循环的bug。


0.0.2.2780
修改分机别名后立即更新分机按钮


0.0.2.2771
添加复电事件3302，0xAD


0.0.2.2770
1.原来的6秒内重复事件不处理修改为4秒
2.索要防区信息时，若无回应则每隔10秒重发一次索要


0.0.2.2765
将ui相关的callback的消息传递方式修改为buffer mode。


0.0.2.2731
恢复主机数据时,若两者不同为状态或属性时认为恢复失败,
同时为状态或属性时但状态或属性值不一致也认为恢复正确.


0.0.2.2713
启用远程控制（对主机或分机按钮右键单击）


0.0.2.2709
1.修复某些机子上不能生成二维码的bug
2.修复某些机子上不能调用python脚本的bug


0.0.2.2684
接警中心所在地到主机所在地的驾车导航完成


0.0.2.2675
百度地图功能基本完成。
主机管理界面内可查看、设置主机坐标
主机或分机界面内可查看、设置主机、分机的坐标


0.0.2.2662
1.修复防区范围错误提示（英文-->中文）
2.试图隐藏掉客户端断线重连时的断线提示：
安定宝ID相同，相同IP、端口的客户端上线时，不显示旧客户端的离线信息。
安定宝ID相同，IP、端口不同的客户端上线时，会显示旧客户端的离线信息。


0.0.2.2617
修复接警中心信息中地图界面上乱码的现象


0.0.2.2610
当发送或接收返回值不大于0时，踢出客户端链接


0.0.2.2592
1.显示的历史记录条数减少1条
2.分机添加防区时最大值为100
3.导出历史记录后清空界面上的历史记录
4.删除未绑定的防区时要求用户确认

SerialFilter更新：
稳定版


0.0.2.2573 钱方名
对任何数据包，回应的seq为发送的seq


0.0.2.2570
对有线防区特殊处理：
1.添加有线防区时不索要，直接添加
2.恢复主机数据时不恢复有线防区数据


0.0.2.2543
自动查询的超时时间为16小时


0.0.2.2534
调用Python脚本使用百度地图服务，自动定位接警中心所在地完成


0.0.2.2521
对恢复操作的回应添加详细的日志记录


0.0.2.2512
完全只靠心跳超时来判断客户端断线


0.0.2.2511
1.修复恢复直属探头时发送的类型为EE的错误
2.收到恢复的回应时，若状态或属性、物理地址与本地数据不一致，则认为这次恢复失败


0.0.2.2456
修改断线判断机制，发送失败后不认为断线


0.0.2.2412
钱工测试专用，带有远程控制功能（在主机按钮上右击）


0.0.2.2403
1.每个1小时检测一次分机上一次的通信时间，
若超过16小时无联系则自动查询

2.为方便测试，暂时每隔1分钟检测一次，超过16分钟无联系则自动查询，
待测试完成，修改为1小时与16小时


0.0.2.2379
1.服务期限检测精确度为1分钟
2.创建主机时默认服务期限为1年后
3.创建主机时若安定宝ID、设备ID非法则不允许创建


0.0.2.2365
添加主机的服务期限管理功能，到期后，
打开该主机界面时每隔1分钟提示1次该主机服务期限已到。


0.0.2.2345
1.心跳超时时间为1分钟
2.检测客户端断开连接，仅使用心跳超时机制


0.0.2.2343
1.踢掉客户端时记录原因
2.优化客户端链接对象的引用锁(TryLock)


0.0.2.2318
修复删除主机后需切换多次才能再次删除主机的bug


0.0.2.2316
添加dump内存数据的功能


0.0.2.2303
安定宝协议中GG值对0xCC做处理


0.0.2.2299
主机界面与分机界面也可以显示与其相关的历史记录


0.0.2.2293
开放索要功能


0.0.2.2290
恢复主机数据，收到回应才认为恢复成功，模拟测试完成


0.0.2.2287
恢复主机数据，发送成功即认为恢复成功，模拟测试完成


0.0.2.2262:
1.更改地图别名后立即刷新
2.分机查询失败后设置断线
3.修复历史记录判断何时弹窗提示的算法bug


0.0.2.2247：
1.查询分机失败后更改分机图标为断线
2.查询所有分机时，若某个分机查询失败则继续查询下一个


0.0.2.2236:
暂时屏蔽“索要”功能


0.0.2.2223:
1.定义主机类型
typedef enum MachineType {
	MT_UNKNOWN = 0, // 未知类型
	MT_WIFI,		// wifi主机
	MT_NETMOD,		// 带网络模块的工程主机
	MT_GPRS,		// gprs主机
	MT_MAX,
}MachineType;

2.网络模块上线报告自己为网络模块（1707），以便接警中心启用备用按钮

3.其他类型的主机暂时不需要上报自己的主机类型

4.协议更改。标准协议的xdata段添加2个字节表示长度，详见《标准协议扩展》

5.禁止添加防区000

6.修复退出编辑后不显示蚂蚁线的bug

7.修复删除地图后崩溃的bug

8.“关于”对话框显示“本次更新”

9.主界面与主机界面中历史记录的更新采用callback + buff + timer的模式，消除死锁隐患

注：以下更新仅针对MT_NETMOD 带网络模块的工程主机

1.添加防区时向工程主机索要防区信息，并根据返回的防区类型（分机、探头、未登记）自动创建防区信息

2.索要或查询防区信息时，保存防区信息（属性或状态、物理地址等）到数据库

3.查询分机时，60秒内如无回应，则每隔20秒重发一次查询。60秒后仍无回应则提示“查询失败”

4.查询所有分机功能完成。依次查询每个分机，查询每个分机的逻辑与查询分机相同（60秒）
